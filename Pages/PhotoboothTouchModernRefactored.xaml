<Page x:Class="Photobooth.Pages.PhotoboothTouchModernRefactored"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Photobooth.Pages"
      xmlns:controls="clr-namespace:Photobooth.Controls"
      mc:Ignorable="d" 
      Background="#1E1E1E"
      Title="Photobooth Touch Interface">

    <Page.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- BoolToBrushConverter for filter selection border -->
        <local:BoolToBrushConverter x:Key="BoolToBrushConverter" 
                                    TrueBrush="#4CAF50" 
                                    FalseBrush="Transparent"/>
        
        <!-- Modern Touch Button Style -->
        <Style x:Key="TouchButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF45A049"/>
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF66BB6A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF757575"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Home Button Style -->
        <Style x:Key="HomeButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FF4CAF50"/>
        </Style>
        
        <!-- Stop Button Style -->
        <Style x:Key="StopButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FFF44336"/>
        </Style>

        <!-- Settings Button Style -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FF2196F3"/>
        </Style>

        <!-- Sharing Button Style -->
        <Style x:Key="SharingButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FF4CAF50"/>
        </Style>
    </Page.Resources>

    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Session Selection Modal (Overlay) -->
        <controls:SessionSelectionModal x:Name="SessionSelectionModal" 
                                        Grid.RowSpan="3"
                                        Panel.ZIndex="1000"/>
        
        <!-- Gallery Browser Modal (Overlay) -->
        <controls:GalleryBrowserModal x:Name="GalleryBrowserModal"
                                      Grid.RowSpan="3"
                                      Panel.ZIndex="999"/>
        
        <!-- Main Live View Area -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Gallery Preview Box (Left Side) -->
            <Border x:Name="galleryPreviewBox"
                    Grid.Column="0"
                    Width="200"
                    Height="250"
                    Margin="20,20,10,20"
                    Background="#3E3E3E"
                    CornerRadius="10"
                    Cursor="Hand"
                    MouseLeftButtonDown="GalleryPreviewBox_Click"
                    MouseEnter="GalleryPreviewBox_MouseEnter"
                    MouseLeave="GalleryPreviewBox_MouseLeave"
                    Visibility="Visible">
                <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="3" Opacity="0.3"/>
                </Border.Effect>
                <Grid>
                    <!-- Preview Image -->
                    <Image x:Name="galleryPreviewImage"
                           Stretch="UniformToFill"
                           Margin="5"/>
                    
                    <!-- Overlay with gallery info -->
                    <Border VerticalAlignment="Bottom"
                            Background="#CC000000"
                            CornerRadius="0,0,10,10">
                        <StackPanel Margin="10,5">
                            <TextBlock Text="📸 Gallery"
                                       Foreground="White"
                                       FontSize="16"
                                       FontWeight="Bold"/>
                            <TextBlock x:Name="galleryPreviewInfo"
                                       Text="No sessions"
                                       Foreground="#CCCCCC"
                                       FontSize="12"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Hover effect -->
                    <Border x:Name="galleryPreviewHover"
                            Background="#33FFFFFF"
                            CornerRadius="10"
                            Visibility="Collapsed">
                        <TextBlock Text="Click to browse"
                                   Foreground="White"
                                   FontSize="14"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Main View Area -->
            <Border Grid.Column="1" Background="#2E2E2E" CornerRadius="10" Margin="10,20,20,20">
                <Grid>
                    <Image x:Name="liveViewImage" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           Stretch="Uniform"/>
                    
                    <!-- Centered Start Button -->
                    <Border x:Name="startButtonOverlay"
                            Width="300"
                            Height="300"
                            CornerRadius="150"
                            Background="#CC4CAF50"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Cursor="Hand"
                            MouseLeftButtonDown="StartButton_Click"
                            Visibility="Collapsed">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="5" Opacity="0.5"/>
                        </Border.Effect>
                        <Grid>
                            <TextBlock Text="TOUCH TO"
                                       FontSize="32"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Margin="0,-50,0,0"/>
                            <TextBlock Text="START"
                                       FontSize="48"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Margin="0,40,0,0"/>
                        </Grid>
                    </Border>
                    
                    <!-- Countdown Overlay -->
                    <Grid x:Name="countdownOverlay" 
                          Background="#80000000" 
                          Visibility="Collapsed">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock x:Name="countdownText" 
                                       Text="3" 
                                       FontSize="200" 
                                       FontWeight="Bold" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Get Ready!" 
                                       FontSize="36" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,20,0,0"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Stop Button (Top Right) -->
                    <Button x:Name="stopSessionButton"
                            Width="50"
                            Height="50"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,20,20,0"
                            Background="#CCFF5252"
                            BorderThickness="0"
                            Visibility="Collapsed"
                            Click="StopButton_Click"
                            Cursor="Hand"
                            ToolTip="Stop Session"
                            Panel.ZIndex="1000">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="25">
                                    <TextBlock Text="✕"
                                               FontSize="24"
                                               FontWeight="Bold"
                                               Foreground="White"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Status Messages -->
                    <Border VerticalAlignment="Top" 
                            HorizontalAlignment="Center" 
                            Background="#CC000000" 
                            CornerRadius="20" 
                            Padding="20,10" 
                            Margin="0,20,0,0">
                        <TextBlock x:Name="statusText" 
                                   Text="Touch START to begin" 
                                   FontSize="24" 
                                   Foreground="White" 
                                   HorizontalAlignment="Center"/>
                    </Border>
                    
                    <!-- Info Panel - Bottom Left -->
                    <Border VerticalAlignment="Bottom" 
                            HorizontalAlignment="Left" 
                            Background="#CC333333" 
                            CornerRadius="10" 
                            Padding="15" 
                            Margin="20,0,0,100"
                            MinWidth="250">
                        <StackPanel>
                            <!-- Camera Status -->
                            <TextBlock x:Name="cameraStatusText" 
                                       Text="Connecting..." 
                                       FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       TextWrapping="Wrap"/>
                            
                            <!-- Photo Count -->
                            <TextBlock x:Name="photoCountText" 
                                       Text="" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Foreground="#4CAF50" 
                                       HorizontalAlignment="Center"
                                       Margin="0,5,0,0"
                                       Visibility="Collapsed"/>
                            
                            <!-- Cloud Sync Status -->
                            <Border Background="Transparent" 
                                    CornerRadius="8" 
                                    Margin="0,8,0,0"
                                    Padding="8,5">
                                <StackPanel>
                                    <TextBlock Text="SYNC STATUS" 
                                               FontSize="10" 
                                               FontWeight="Bold"
                                               Foreground="#00B4D8" 
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,3"/>
                                    
                                    <!-- Sync Status Display -->
                                    <Grid HorizontalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Status Icon -->
                                        <Border x:Name="syncStatusIcon" 
                                                Grid.Column="0"
                                                Width="8" 
                                                Height="8" 
                                                CornerRadius="4"
                                                Background="#4CAF50"
                                                Margin="0,0,5,0"
                                                VerticalAlignment="Center">
                                            <Border.ToolTip>
                                                <ToolTip x:Name="syncStatusTooltip" Content="All uploads current"/>
                                            </Border.ToolTip>
                                        </Border>
                                        
                                        <!-- Status Text -->
                                        <TextBlock x:Name="syncStatusText" 
                                                   Grid.Column="1"
                                                   Text="Uploads Current" 
                                                   FontSize="12" 
                                                   Foreground="#4CAF50"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                    
                    <!-- Countdown Quick Controls (Floating Panel) -->
                    <Border VerticalAlignment="Top" 
                            HorizontalAlignment="Right" 
                            Background="#CC333333" 
                            CornerRadius="10" 
                            Padding="10" 
                            Margin="0,80,20,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Countdown:" 
                                       FontSize="14" 
                                       Foreground="White" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <Button Content="-" 
                                    Width="40" 
                                    Height="40" 
                                    FontSize="20" 
                                    FontWeight="Bold"
                                    Background="#FF555555"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Click="DecreaseCountdown_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="20">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <TextBlock x:Name="countdownSecondsDisplay" 
                                       Text="5s" 
                                       FontSize="20" 
                                       FontWeight="Bold" 
                                       Foreground="#4CAF50" 
                                       VerticalAlignment="Center" 
                                       Margin="10,0,10,0"/>
                            <Button Content="+" 
                                    Width="40" 
                                    Height="40" 
                                    FontSize="20" 
                                    FontWeight="Bold"
                                    Background="#FF555555"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Click="IncreaseCountdown_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="20">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </Border>
                    
                    <!-- Back Button (Bottom Right) -->
                    <Button x:Name="backButton"
                            Width="80"
                            Height="80"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,20,20"
                            Background="#CC2196F3"
                            BorderThickness="0"
                            Click="BackButton_Click"
                            Cursor="Hand"
                            ToolTip="Go Back">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="40">
                                    <StackPanel HorizontalAlignment="Center" 
                                                VerticalAlignment="Center">
                                        <TextBlock Text="←" 
                                                   FontSize="32"
                                                   HorizontalAlignment="Center"
                                                   Foreground="White"/>
                                        <TextBlock Text="BACK" 
                                                   FontSize="14"
                                                   Margin="0,2,0,0"
                                                   HorizontalAlignment="Center"
                                                   Foreground="White"/>
                                    </StackPanel>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Bottom Control Area (Row 1) -->
        <Grid Grid.Row="1" Margin="20,0,20,10">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel x:Name="photosContainer" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center">
                    <!-- Captured photos will be added here dynamically -->
                </StackPanel>
            </ScrollViewer>
        </Grid>
        
        <!-- Action Buttons Area (Row 2) -->
        <Grid Grid.Row="2" Margin="20,0,20,20">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <!-- Home Button -->
                <Button x:Name="homeButton"
                        Content="🏠 HOME"
                        Style="{StaticResource HomeButtonStyle}"
                        Width="180"
                        Height="70"
                        FontSize="20"
                        Visibility="Collapsed"
                        Click="HomeButton_Click"/>
                
                <!-- Unified Action Buttons Panel (works for both session completion and gallery) -->
                <StackPanel x:Name="actionButtonsPanel" 
                           Orientation="Horizontal" 
                           HorizontalAlignment="Center" 
                           Visibility="Collapsed">
                    
                    <!-- Share Button -->
                    <Button x:Name="shareButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#2196F3"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Share Photos"
                            Click="ShareButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- Print Button -->
                    <Button x:Name="printButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#4CAF50"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Print Photos"
                            Click="PrintButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M19,8H5A3,3 0 0,0 2,11V17H6V21A1,1 0 0,0 7,22H17A1,1 0 0,0 18,21V17H22V11A3,3 0 0,0 19,8M16,20H8V15H16V20M19,12A1,1 0 0,1 18,13A1,1 0 0,1 17,12A1,1 0 0,1 18,11A1,1 0 0,1 19,12M18,3H6V7H18V3Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- Email Button -->
                    <Button x:Name="emailButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#FF9800"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Email Photos"
                            Click="EmailButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4M20,8L12,13L4,8V6L12,11L20,6V8Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- SMS Button -->
                    <Button x:Name="smsButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#9C27B0"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Send SMS"
                            Click="SmsButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- QR Code Button -->
                    <Button x:Name="qrButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#607D8B"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Show QR Code"
                            Click="QrButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H13V15H15V13H17V15H15V11M1,5H9V13H1V5M3,7V11H7V7H3M15,5H23V13H15V5M17,7V11H21V7H17M1,15H9V23H1V15M3,17V21H7V17H3Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- Done Button -->
                    <Button x:Name="doneButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#4CAF50"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Done"
                            Click="DoneButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                    
                    <!-- Exit Button (for gallery mode) -->
                    <Button x:Name="exitButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Background="#F44336"
                            Width="80"
                            Height="80"
                            Margin="10"
                            ToolTip="Exit to Menu"
                            Visibility="Collapsed"
                            Click="ExitButton_Click">
                        <Viewbox Width="40" Height="40">
                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                  Fill="White"/>
                        </Viewbox>
                    </Button>
                </StackPanel>
                
                <!-- Settings Button -->
                <Button x:Name="settingsButton"
                        Content="⚙️ SETTINGS"
                        Style="{StaticResource SettingsButtonStyle}"
                        Width="180"
                        Height="70"
                        FontSize="20"
                        Visibility="Collapsed"
                        Click="SettingsButton_Click"/>
                
                <!-- Gallery Button -->
                <Button x:Name="galleryButton"
                        Content="📸 GALLERY"
                        Style="{StaticResource TouchButtonStyle}"
                        Background="#FF9800"
                        Width="180"
                        Height="70"
                        FontSize="20"
                        Visibility="Collapsed"
                        Click="GalleryButton_Click"/>
                
                <!-- Removed duplicate gallery navigation panel - using unified actionButtonsPanel instead -->
            </StackPanel>
        </Grid>
        
        <!-- Bottom Control Bar (Collapsible) -->
        <Border x:Name="bottomControlBar" 
                Grid.Row="2" 
                Background="#333333" 
                Padding="20"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left Panel - Empty for balance -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left">
                    <!-- Keep empty for visual balance -->
                </StackPanel>
                
                <!-- Center Panel - Empty for balance -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <!-- Keep empty for visual balance -->
                </StackPanel>
                
                <!-- Right Panel - Event, Print, Camera, Timer, Settings -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Style="{StaticResource TouchButtonStyle}"
                            Background="#9C27B0"
                            Width="120" 
                            Height="50" 
                            Margin="5"
                            Click="SelectEventButton_Click"
                            ToolTip="Select Event">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🎉" FontSize="18" Margin="0,0,6,0"/>
                            <TextBlock Text="Event" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TouchButtonStyle}"
                            Background="#4CAF50"
                            Width="120" 
                            Height="50" 
                            Margin="5"
                            Click="PrintSettingsButton_Click"
                            ToolTip="Print Settings">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🖨️" FontSize="18" Margin="0,0,6,0"/>
                            <TextBlock Text="Print" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TouchButtonStyle}"
                            Background="#2196F3"
                            Width="140" 
                            Height="50" 
                            Margin="5"
                            Click="CameraSettingsButton_Click"
                            ToolTip="Camera Settings">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📷" FontSize="18" Margin="0,0,6,0"/>
                            <TextBlock Text="Camera" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TouchButtonStyle}"
                            Background="#FF9800"
                            Width="120" 
                            Height="50" 
                            Margin="5"
                            Click="TimerSettingsButton_Click"
                            ToolTip="Timer Settings">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⏲️" FontSize="18" Margin="0,0,6,0"/>
                            <TextBlock Text="Timer" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TouchButtonStyle}"
                            Background="#9C27B0"
                            Width="140" 
                            Height="50" 
                            Margin="5"
                            Click="SettingsButton_Click"
                            ToolTip="General Settings">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⚙️" FontSize="18" Margin="0,0,6,0"/>
                            <TextBlock Text="Settings" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Bottom Bar Toggle Button (Chevron) -->
        <Border Grid.RowSpan="3"
                VerticalAlignment="Bottom" 
                HorizontalAlignment="Left" 
                Background="#FF444444" 
                CornerRadius="0,20,0,0" 
                Padding="20,15" 
                Margin="20,0,0,0"
                Cursor="Hand"
                Panel.ZIndex="500"
                MouseLeftButtonDown="ToggleBottomBar_Click">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="5" Opacity="0.7"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="bottomBarToggleChevron" 
                           Text="⌃" 
                           FontSize="24" 
                           Foreground="White" 
                           FontWeight="Bold"
                           Margin="0,0,10,0"/>
                <TextBlock Text="Settings" 
                           FontSize="14" 
                           Foreground="White" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- Old Event Selection Overlay - Replaced by EventSelectionOverlayControl -->
        <!-- Commented out to avoid conflicts with new EventSelectionOverlay control
        <Grid x:Name="eventSelectionOverlay" 
              Grid.Row="0" Grid.RowSpan="3" 
              Background="#CC000000" 
              Visibility="Collapsed">
        </Grid>
        -->
        
        <!-- Template Selection Overlay -->
        <Grid x:Name="templateSelectionOverlay" 
              Grid.Row="0" Grid.RowSpan="3" 
              Background="#CC000000" 
              Visibility="Collapsed">
            
            <Border Background="#2D2D30" 
                    CornerRadius="20" 
                    MaxWidth="1000" 
                    MaxHeight="700" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center"
                    Padding="40">
                <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="25" ShadowDepth="10" Opacity="0.7"/>
                </Border.Effect>
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,30">
                        <TextBlock x:Name="templateSelectionEventName"
                                   Text="Select Template" 
                                   FontSize="32" 
                                   FontWeight="Bold" 
                                   Foreground="White" 
                                   HorizontalAlignment="Center"/>
                        <TextBlock x:Name="templateSelectionEventDescription"
                                   Text="" 
                                   FontSize="18" 
                                   Foreground="#CCCCCC" 
                                   HorizontalAlignment="Center"
                                   Margin="0,10,0,0"/>
                    </StackPanel>
                    
                    <!-- Template List -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="templatesList" Margin="0,0,0,20">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#404040" 
                                            CornerRadius="10" 
                                            Margin="10" 
                                            Width="200"
                                            Height="280"
                                            Cursor="Hand"
                                            MouseLeftButtonDown="TemplateItem_Click">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#404040"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#4CAF50"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        
                                        <StackPanel Margin="15">
                                            <!-- Template Preview -->
                                            <Border Background="#333" 
                                                    Height="150" 
                                                    CornerRadius="5" 
                                                    Margin="0,0,0,10">
                                                <TextBlock Text="📷" 
                                                           FontSize="48" 
                                                           HorizontalAlignment="Center" 
                                                           VerticalAlignment="Center" 
                                                           Foreground="#666"/>
                                            </Border>
                                            
                                            <!-- Template Info -->
                                            <TextBlock Text="{Binding Name}" 
                                                       FontSize="18" 
                                                       FontWeight="Bold" 
                                                       Foreground="White"
                                                       TextAlignment="Center"
                                                       TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="14" 
                                                       Foreground="#CCCCCC" 
                                                       Margin="0,5,0,0" 
                                                       TextAlignment="Center"
                                                       TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Back Button -->
                    <Button Grid.Row="2" 
                            Content="← Back to Events" 
                            Style="{StaticResource TouchButtonStyle}" 
                            Background="#666666"
                            Width="250" 
                            Height="60" 
                            FontSize="18" 
                            HorizontalAlignment="Center" 
                            Click="BackToEventSelection_Click"/>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Event Gallery Overlay -->
        <controls:GalleryOverlayControl x:Name="galleryOverlay"
                                        Grid.RowSpan="3"
                                        Visibility="Collapsed"/>
        
        <!-- Template Selection Overlay -->
        <Grid x:Name="templateSelectionOverlayNew"
              Grid.RowSpan="3"
              Background="#E0000000"
              Visibility="Collapsed">
            <Border Background="#FF2E2E2E"
                    CornerRadius="20"
                    Margin="50"
                    Padding="30">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Grid Grid.Row="0">
                        <TextBlock x:Name="templateSelectionTitle"
                                   Text="Select Template"
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,20"/>
                        
                        <!-- Close Button -->
                        <Button x:Name="closeTemplateSelection"
                                Content="✕"
                                Style="{StaticResource TouchButtonStyle}"
                                Background="#CC000000"
                                Width="50"
                                Height="50"
                                FontSize="24"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Margin="0,-10,-10,0"
                                Click="CloseTemplateSelection_Click"/>
                    </Grid>
                    
                    <!-- Subtitle -->
                    <TextBlock Grid.Row="1"
                               x:Name="templateSelectionSubtitle"
                               Text="Choose your photo layout"
                               FontSize="18"
                               Foreground="#CCCCCC"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,30"/>
                    
                    <!-- Templates Grid -->
                    <ScrollViewer Grid.Row="2"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl x:Name="templatesGrid">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"
                                               HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border x:Name="templateCard"
                                            Background="Transparent"
                                            CornerRadius="15"
                                            Width="320"
                                            Height="400"
                                            Margin="15"
                                            Cursor="Hand"
                                            MouseLeftButtonDown="TemplateCard_Click">
                                        <Border.Effect>
                                            <DropShadowEffect Color="Black"
                                                              BlurRadius="8"
                                                              ShadowDepth="3"
                                                              Opacity="0.2"/>
                                        </Border.Effect>
                                        
                                        <Grid>
                                            <!-- Template Preview Container - Full size -->
                                            <Grid>
                                                <!-- Actual Template Layout Preview -->
                                                <ContentPresenter x:Name="templatePreview"
                                                                  Content="{Binding Preview}"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"
                                                                  Margin="10"/>
                                                
                                                <!-- Selection Overlay -->
                                                <Border x:Name="selectedOverlay"
                                                        Background="#4C4CAF50"
                                                        CornerRadius="10"
                                                        Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <TextBlock Text="✓ Selected"
                                                               FontSize="24"
                                                               FontWeight="Bold"
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                            </Grid>
                                            
                                        </Grid>
                                        
                                        <!-- Hover Effect -->
                                        <Border.Triggers>
                                            <EventTrigger RoutedEvent="MouseEnter">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                                         To="1.05"
                                                                         Duration="0:0:0.2"/>
                                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                                         To="1.05"
                                                                         Duration="0:0:0.2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                            <EventTrigger RoutedEvent="MouseLeave">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                                         To="1.0"
                                                                         Duration="0:0:0.2"/>
                                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                                         To="1.0"
                                                                         Duration="0:0:0.2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Border.Triggers>
                                        
                                        <Border.RenderTransform>
                                            <ScaleTransform ScaleX="1" ScaleY="1"
                                                            CenterX="160" CenterY="225"/>
                                        </Border.RenderTransform>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Footer Message -->
                    <TextBlock Grid.Row="3"
                               Text="Click on a template to start your session"
                               FontSize="14"
                               Foreground="#999999"
                               HorizontalAlignment="Center"
                               Margin="0,20,0,0"/>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Print Copies Modal -->
        <controls:PrintCopiesModal x:Name="printCopiesModal" />
        
        <!-- Retake Selection Overlay -->
        <Grid x:Name="retakeSelectionOverlay"
              Background="#CC000000"
              Visibility="Collapsed"
              Grid.RowSpan="3">
            <Border Background="#1E1E1E"
                    CornerRadius="20"
                    MaxWidth="1400"
                    MaxHeight="900"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Margin="40">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="30,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Review Your Photos"
                                       FontSize="32"
                                       FontWeight="Light"
                                       Foreground="White"/>
                            <TextBlock x:Name="retakeInstructionText"
                                       Text="Click on any photo you want to retake"
                                       FontSize="16"
                                       Foreground="#AAAAAA"
                                       Margin="0,5,0,0"/>
                        </StackPanel>
                        
                        <!-- Timer Display -->
                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <TextBlock Text="Time remaining: "
                                       FontSize="16"
                                       Foreground="#AAAAAA"
                                       VerticalAlignment="Center"/>
                            <TextBlock x:Name="retakeTimerText"
                                       Text="15"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="s"
                                       FontSize="16"
                                       Foreground="#AAAAAA"
                                       VerticalAlignment="Center"
                                       Margin="2,0,0,0"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Photo Grid -->
                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Margin="20,0">
                        <ItemsControl x:Name="retakePhotoGrid"
                                      HorizontalAlignment="Center">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"
                                               HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="15"
                                            Width="350"
                                            Height="280"
                                            CornerRadius="10"
                                            Background="#2A2A2A"
                                            BorderThickness="3"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="RetakePhoto_Click"
                                            Tag="{Binding PhotoIndex}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding MarkedForRetake}" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FF4444"/>
                                                    </DataTrigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Opacity" Value="0.8"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        
                                        <Grid>
                                            <!-- Photo -->
                                            <Image Source="{Binding Image}"
                                                   Stretch="UniformToFill"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            
                                            <!-- Label -->
                                            <TextBlock Text="{Binding Label}"
                                                       FontSize="14"
                                                       Foreground="White"
                                                       Background="#AA000000"
                                                       Padding="8,4"
                                                       HorizontalAlignment="Left"
                                                       VerticalAlignment="Top"
                                                       Margin="10"/>
                                            
                                            <!-- Retake Indicator -->
                                            <Grid Visibility="{Binding MarkedForRetake, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Rectangle Fill="#55FF0000"/>
                                                <TextBlock Text="RETAKE"
                                                           FontSize="28"
                                                           FontWeight="Bold"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center">
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect Color="Black" 
                                                                          ShadowDepth="2" 
                                                                          BlurRadius="5"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                            </Grid>
                                            
                                            <!-- Hover Overlay -->
                                            <Border x:Name="hoverOverlay"
                                                    Background="#44FFFFFF"
                                                    Visibility="Collapsed">
                                                <TextBlock Text="&#xE74D;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="48"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="2" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="20">
                        <Button x:Name="retakeSelectedButton"
                                Content="Retake Selected"
                                Width="180"
                                Height="50"
                                Margin="10"
                                FontSize="16"
                                Background="#FF4444"
                                Foreground="White"
                                BorderThickness="0"
                                Click="RetakeSelected_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF6666"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="skipRetakeButton"
                                Content="Skip Retake"
                                Width="180"
                                Height="50"
                                Margin="10"
                                FontSize="16"
                                Background="#404040"
                                Foreground="White"
                                BorderThickness="0"
                                Click="SkipRetake_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Filter Selection Overlay -->
        <Grid x:Name="filterSelectionOverlay" 
              Grid.RowSpan="3"
              Grid.ColumnSpan="3"
              Background="#E6000000"
              Visibility="Collapsed">
            
            <Border MaxWidth="1600" MaxHeight="900" Margin="40"
                    Background="#1E1E1E"
                    CornerRadius="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Background="#2D2D30" CornerRadius="15,15,0,0" Padding="20">
                        <Grid>
                            <TextBlock Text="Select Photo Filter" 
                                       FontSize="28" 
                                       FontWeight="Bold" 
                                       Foreground="White"
                                       HorizontalAlignment="Center"/>
                            <Button x:Name="closeFilterSelection" 
                                    Content="✕" 
                                    FontSize="24"
                                    Width="40" 
                                    Height="40"
                                    HorizontalAlignment="Right"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Foreground="White"
                                    Click="CloseFilterSelection_Click"/>
                        </Grid>
                    </Border>
                    
                    <!-- Filter Options Grid -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="20">
                        <ItemsControl x:Name="filterItemsControl">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Width="320" 
                                            Height="400" 
                                            Margin="15"
                                            Background="#2D2D30"
                                            BorderBrush="#007ACC"
                                            BorderThickness="2"
                                            Click="FilterButton_Click"
                                            Tag="{Binding FilterType}"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="12">
                                                                <Border.Effect>
                                                                    <DropShadowEffect Color="Black" BlurRadius="8" ShadowDepth="4" Opacity="0.3"/>
                                                                </Border.Effect>
                                                                <Grid>
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="*"/>
                                                                        <RowDefinition Height="50"/>
                                                                    </Grid.RowDefinitions>
                                                                    
                                                                    <!-- Filter Preview Image -->
                                                                    <Border Grid.Row="0" 
                                                                            Margin="8"
                                                                            CornerRadius="8"
                                                                            ClipToBounds="True">
                                                                        <Image Source="{Binding PreviewImage}" 
                                                                               Stretch="UniformToFill"
                                                                               RenderOptions.BitmapScalingMode="HighQuality">
                                                                            <Image.Style>
                                                                                <Style TargetType="Image">
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding PreviewImage}" Value="{x:Null}">
                                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </Image.Style>
                                                                        </Image>
                                                                    </Border>
                                                                    
                                                                    <!-- Loading indicator when no preview -->
                                                                    <TextBlock Grid.Row="0"
                                                                               Text="Loading..."
                                                                               FontSize="14"
                                                                               Foreground="#808080"
                                                                               HorizontalAlignment="Center"
                                                                               VerticalAlignment="Center">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding PreviewImage}" Value="{x:Null}">
                                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                    
                                                                    <!-- Filter Name -->
                                                                    <Border Grid.Row="1" 
                                                                            Background="#1A1A1A" 
                                                                            CornerRadius="0,0,12,12">
                                                                        <TextBlock Text="{Binding Name}"
                                                                                   HorizontalAlignment="Center"
                                                                                   VerticalAlignment="Center"
                                                                                   Foreground="White"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                </Grid>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#3D3D40"/>
                                                        <Setter Property="BorderBrush" Value="#00A0E4"/>
                                                        <Setter Property="BorderThickness" Value="3"/>
                                                    </Trigger>
                                                    <Trigger Property="IsPressed" Value="True">
                                                        <Setter Property="Background" Value="#4D4D50"/>
                                                        <Setter Property="BorderBrush" Value="#00C0FF"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="2" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="20">
                        <Button x:Name="applyNoFilterButton"
                                Content="Continue Without Filter"
                                Width="200"
                                Height="50"
                                Margin="10"
                                FontSize="16"
                                Background="#404040"
                                Foreground="White"
                                BorderThickness="0"
                                Click="ApplyNoFilter_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Camera Settings Overlay -->
        <controls:CameraSettingsOverlay x:Name="CameraSettingsOverlayControl" 
                                         Visibility="Collapsed"
                                         Grid.RowSpan="10"
                                         Panel.ZIndex="1000"/>
        
        <!-- Timer Settings Overlay -->
        <controls:TimerSettingsOverlay x:Name="TimerSettingsOverlayControl" 
                                        Visibility="Collapsed"
                                        Grid.RowSpan="10"
                                        Panel.ZIndex="1000"/>
        
        <!-- Print Settings Overlay -->
        <controls:PrintSettingsOverlay x:Name="PrintSettingsOverlayControl" 
                                        Visibility="Collapsed"
                                        Grid.RowSpan="10"
                                        Panel.ZIndex="1000"/>
        
        <!-- Event Selection Overlay -->
        <controls:EventSelectionOverlay x:Name="EventSelectionOverlayControl"
                                         Visibility="Collapsed"
                                         Grid.RowSpan="10"
                                         Panel.ZIndex="1000"/>
    </Grid>
</Page>