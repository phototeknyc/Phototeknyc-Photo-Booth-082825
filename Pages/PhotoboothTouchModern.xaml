<Page x:Class="Photobooth.Pages.PhotoboothTouchModern"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Photobooth.Pages"
      xmlns:controls="clr-namespace:Photobooth.Controls"
      mc:Ignorable="d" 
      Background="#1E1E1E"
      Title="Photobooth Touch Interface">

    <Page.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- BoolToBrushConverter for filter selection border -->
        <local:BoolToBrushConverter x:Key="BoolToBrushConverter" 
                                    TrueBrush="#4CAF50" 
                                    FalseBrush="Transparent"/>
        
        <!-- Modern Touch Button Style -->
        <Style x:Key="TouchButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF45A049"/>
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF66BB6A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF757575"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Home Button Style -->
        <Style x:Key="HomeButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FF4CAF50"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF388E3C"/>
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF66BB6A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Stop Button Style -->
        <Style x:Key="StopButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FFF44336"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFD32F2F"/>
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFE57373"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF757575"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Settings Button Style -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button" BasedOn="{StaticResource TouchButtonStyle}">
            <Setter Property="Background" Value="#FF2196F3"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF1976D2"/>
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF64B5F6"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF757575"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Session Selection Modal (Overlay) -->
        <controls:SessionSelectionModal x:Name="SessionSelectionModal" 
                                        Grid.RowSpan="3"
                                        Panel.ZIndex="1000"/>
        
        <!-- Main Live View Area -->
        <Grid Grid.Row="0">
            <Border Background="#2E2E2E" CornerRadius="10" Margin="20">
                <Grid>
                    <Image x:Name="liveViewImage" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           Stretch="Uniform"/>
                    
                    <!-- Centered Start Button -->
                    <Border x:Name="startButtonOverlay"
                            Width="300"
                            Height="300"
                            CornerRadius="150"
                            Background="#CC4CAF50"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Cursor="Hand"
                            MouseLeftButtonDown="StartButton_Click"
                            Visibility="Collapsed">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="5" Opacity="0.5"/>
                        </Border.Effect>
                        <Grid>
                            <TextBlock Text="TOUCH TO"
                                       FontSize="32"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Margin="0,-50,0,0"/>
                            <TextBlock Text="START"
                                       FontSize="48"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Margin="0,40,0,0"/>
                        </Grid>
                    </Border>
                    
                    <!-- Countdown Overlay -->
                    <Grid x:Name="countdownOverlay" 
                          Background="#80000000" 
                          Visibility="Collapsed">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock x:Name="countdownText" 
                                       Text="3" 
                                       FontSize="200" 
                                       FontWeight="Bold" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Get Ready!" 
                                       FontSize="36" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,20,0,0"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Stop Button (Top Right) - Placed after countdown overlay to be on top -->
                    <Button x:Name="stopSessionButton"
                            Width="50"
                            Height="50"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,20,20,0"
                            Background="#CCFF5252"
                            BorderThickness="0"
                            Visibility="Collapsed"
                            Click="StopButton_Click"
                            Cursor="Hand"
                            ToolTip="Stop Session"
                            Panel.ZIndex="1000">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="25">
                                    <TextBlock Text="✕"
                                               FontSize="24"
                                               FontWeight="Bold"
                                               Foreground="White"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Session Loaded Indicator -->
                    <Border x:Name="sessionLoadedIndicator"
                            VerticalAlignment="Top"
                            HorizontalAlignment="Right"
                            Margin="20"
                            Background="#CC0078D4"
                            CornerRadius="8"
                            Padding="15,8"
                            Visibility="Collapsed">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📂" FontSize="18" Margin="0,0,8,0" Foreground="White"/>
                            <TextBlock x:Name="sessionInfoText" 
                                       Text="Session Loaded" 
                                       FontSize="14" 
                                       FontWeight="SemiBold"
                                       Foreground="White"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Photo View Mode Indicator -->
                    <Border x:Name="photoViewModeIndicator"
                            VerticalAlignment="Bottom"
                            HorizontalAlignment="Left"
                            Margin="20"
                            Background="#CC4CAF50"
                            CornerRadius="8"
                            Padding="12,6"
                            Visibility="Collapsed">
                        <TextBlock Text="📷 Click photos below to view" 
                                   FontSize="14" 
                                   FontWeight="SemiBold"
                                   Foreground="White"/>
                    </Border>
                    
                    <!-- Composed Image Navigation (when multiple layouts exist) -->
                    <StackPanel x:Name="composedImageNavigation"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Bottom"
                                Margin="0,0,0,20"
                                Visibility="Collapsed">
                        <Button x:Name="prevComposedButton"
                                Content="◀"
                                Width="50"
                                Height="50"
                                FontSize="20"
                                Background="#CC555555"
                                Foreground="White"
                                BorderThickness="0"
                                Margin="0,0,10,0"
                                Click="PrevComposedImage_Click">
                            <Button.Resources>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="25">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Resources>
                        </Button>
                        
                        <TextBlock x:Name="composedImageIndexText"
                                   Text="1 / 1"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   VerticalAlignment="Center"
                                   Margin="10,0"/>
                        
                        <Button x:Name="nextComposedButton"
                                Content="▶"
                                Width="50"
                                Height="50"
                                FontSize="20"
                                Background="#CC555555"
                                Foreground="White"
                                BorderThickness="0"
                                Margin="10,0,0,0"
                                Click="NextComposedImage_Click">
                            <Button.Resources>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="25">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </StackPanel>

                    <!-- Status Messages -->
                    <Border VerticalAlignment="Top" 
                            HorizontalAlignment="Center" 
                            Background="#CC000000" 
                            CornerRadius="20" 
                            Padding="20,10" 
                            Margin="0,20,0,0">
                        <TextBlock x:Name="statusText" 
                                   Text="Touch START to begin" 
                                   FontSize="24" 
                                   Foreground="White" 
                                   HorizontalAlignment="Center"/>
                    </Border>
                    
                    <!-- Info Panel - Bottom Left -->
                    <Border VerticalAlignment="Bottom" 
                            HorizontalAlignment="Left" 
                            Background="#CC333333" 
                            CornerRadius="10" 
                            Padding="15" 
                            Margin="20,0,0,100"
                            MinWidth="250">
                        <StackPanel>
                            <!-- Camera Status -->
                            <TextBlock x:Name="cameraStatusText" 
                                       Text="Connecting..." 
                                       FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       TextWrapping="Wrap"/>
                            
                            <!-- Photo Count -->
                            <TextBlock x:Name="photoCountText" 
                                       Text="Photos: 0" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Foreground="#4CAF50" 
                                       HorizontalAlignment="Center"
                                       Margin="0,5,0,0"/>
                            
                            <!-- Separator -->
                            <Border Height="1" 
                                    Background="#666" 
                                    Margin="0,10,0,10"/>
                            
                            <!-- Printer Status Header -->
                            <TextBlock Text="PRINTER STATUS" 
                                       FontSize="11" 
                                       FontWeight="Bold"
                                       Foreground="#00B4D8" 
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,5"/>
                            
                            <!-- Printer Info -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Printer Name and Connection -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock x:Name="printerNameText" 
                                               Text="No Printer" 
                                               FontSize="12" 
                                               Foreground="White"
                                               FontWeight="SemiBold"/>
                                    <TextBlock x:Name="printerConnectionText" 
                                               Text=" (Offline)" 
                                               FontSize="12" 
                                               Foreground="#FF9800"
                                               FontWeight="Normal"/>
                                </StackPanel>
                                
                                <!-- Printer Status -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,3,0,0">
                                    <Border x:Name="printerStatusIndicator" 
                                            Width="8" 
                                            Height="8" 
                                            CornerRadius="4"
                                            Background="#4CAF50"
                                            Margin="0,0,5,0"
                                            VerticalAlignment="Center"/>
                                    <TextBlock x:Name="printerStatusText" 
                                               Text="Ready" 
                                               FontSize="13" 
                                               Foreground="#4CAF50"
                                               FontWeight="Normal"/>
                                </StackPanel>
                                
                                <!-- Print Queue Info -->
                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,3,0,0">
                                    <TextBlock Text="Queue: " 
                                               FontSize="11" 
                                               Foreground="#AAA"/>
                                    <TextBlock x:Name="printerQueueText" 
                                               Text="0" 
                                               FontSize="11" 
                                               Foreground="White"
                                               FontWeight="Bold"/>
                                    <TextBlock Text=" jobs" 
                                               FontSize="11" 
                                               Foreground="#AAA"
                                               Margin="2,0,0,0"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Error Message (if any) -->
                            <TextBlock x:Name="printerErrorText" 
                                       Text="" 
                                       FontSize="11" 
                                       Foreground="#FF5252"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       Margin="0,5,0,0"
                                       Visibility="Collapsed"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Countdown Quick Controls (Floating Panel) -->
                    <Border VerticalAlignment="Top" 
                            HorizontalAlignment="Right" 
                            Background="#CC333333" 
                            CornerRadius="10" 
                            Padding="10" 
                            Margin="0,80,20,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Countdown:" 
                                       FontSize="14" 
                                       Foreground="White" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <Button Content="-" 
                                    Width="40" 
                                    Height="40" 
                                    FontSize="20" 
                                    FontWeight="Bold"
                                    Background="#FF555555"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Click="DecreaseCountdown_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="20">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <TextBlock x:Name="countdownSecondsDisplay" 
                                       Text="5s" 
                                       FontSize="20" 
                                       FontWeight="Bold" 
                                       Foreground="#4CAF50" 
                                       VerticalAlignment="Center" 
                                       Margin="10,0,10,0"/>
                            <Button Content="+" 
                                    Width="40" 
                                    Height="40" 
                                    FontSize="20" 
                                    FontWeight="Bold"
                                    Background="#FF555555"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Click="IncreaseCountdown_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="20">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </Border>
                    
                    <!-- Done Button - Above Print Button -->
                    <Button x:Name="doneButton" 
                            Width="80" 
                            Height="80"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,50,300"
                            Background="#CC4CAF50"
                            BorderThickness="0"
                            FontSize="18"
                            FontWeight="Bold"
                            Foreground="White"
                            ToolTip="Clear Session"
                            Visibility="Collapsed"
                            Click="DoneButton_Click">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="40">
                                    <StackPanel HorizontalAlignment="Center" 
                                                VerticalAlignment="Center">
                                        <TextBlock Text="✓" 
                                                   FontSize="32"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="DONE" 
                                                   FontSize="14"
                                                   Margin="0,2,0,0"
                                                   HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Gallery Button - Below Print Button -->
                    <Button x:Name="galleryButton" 
                            Width="80" 
                            Height="80"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,50,100"
                            Background="#FF9C27B0"
                            BorderThickness="0"
                            FontSize="28"
                            FontWeight="Bold"
                            Foreground="White"
                            ToolTip="View Sessions"
                            Visibility="Visible"
                            Click="GalleryButton_Click">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="40">
                                    <StackPanel HorizontalAlignment="Center" 
                                                VerticalAlignment="Center">
                                        <TextBlock Text="📂" 
                                                   FontSize="32"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="GALLERY" 
                                                   FontSize="12"
                                                   Margin="0,2,0,0"
                                                   HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Print Button - Positioned to the right of preview screen -->
                    <Button x:Name="printButton" 
                            Width="80" 
                            Height="80"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,50,200"
                            Background="#FF2196F3"
                            BorderThickness="0"
                            Content="🖨️"
                            FontSize="32"
                            Foreground="White"
                            FontWeight="Bold"
                            ToolTip="Print Photo"
                            Visibility="Collapsed"
                            Click="PrintButton_Click">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="10">
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                      VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FF1976D2"/>
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <ScaleTransform ScaleX="1.05" ScaleY="1.05"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Top Left Controls -->
                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"
                                Margin="20">
                        <!-- Exit Button -->
                        <Button x:Name="exitButton" 
                                Width="60" 
                                Height="60"
                                Margin="0,0,10,0"
                                Background="#FFE74C3C"
                                BorderThickness="0"
                                Content="✕"
                                FontSize="24"
                                Foreground="White"
                                FontWeight="Bold"
                                ToolTip="Exit"
                                Click="ExitButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="5">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <!-- Home Button -->
                        <Button x:Name="homeButton" 
                                Width="60" 
                                Height="60"
                                Margin="0,0,10,0"
                                Background="#FF4CAF50"
                                BorderThickness="0"
                                Content="🏠"
                                FontSize="24"
                                Foreground="White"
                                FontWeight="Bold"
                                ToolTip="Return to Home"
                                Click="HomeButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="5">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <!-- Lock/Unlock Button -->
                        <Button x:Name="lockButton" 
                                Width="60" 
                                Height="60"
                                Background="#FF555555"
                                BorderThickness="0"
                                Content="🔓"
                                FontSize="24"
                                Foreground="White"
                                FontWeight="Bold"
                                ToolTip="Lock Interface"
                                Click="LockButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="5">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Photo Strip Display (Expanded) -->
        <Border Grid.Row="1" 
                Grid.RowSpan="2"
                Background="#1E1E1E" 
                Padding="15,20"
                Margin="0,0,0,40">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Label -->
                <TextBlock Grid.Row="0" 
                           Text="PHOTO SEQUENCE" 
                           FontSize="12" 
                           FontWeight="Bold"
                           Foreground="#888"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,5"/>
                
                <!-- Photo Thumbnails -->
                <ScrollViewer Grid.Row="1" 
                              HorizontalScrollBarVisibility="Hidden"
                              VerticalScrollBarVisibility="Disabled"
                              HorizontalAlignment="Center">
                    <ItemsControl x:Name="photoStripControl"
                                  HorizontalAlignment="Center">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" 
                                            HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="PhotoStripItemBorder"
                                        Width="150" 
                                        Height="120" 
                                        Margin="10"
                                        CornerRadius="8"
                                        BorderThickness="2"
                                        RenderTransformOrigin="0.5,0.5"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="PhotoStripItem_Click"
                                        Tag="{Binding}">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="BorderBrush" Value="#444"/>
                                            <Setter Property="RenderTransform">
                                                <Setter.Value>
                                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <!-- Selected photo highlight -->
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="BorderBrush" Value="#0078D4"/>
                                                    <Setter Property="BorderThickness" Value="3"/>
                                                </DataTrigger>
                                                <!-- Mouse hover effect -->
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Opacity" Value="0.8"/>
                                                </Trigger>
                                                <DataTrigger Binding="{Binding IsPlaceholder}" Value="False">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                                                                                From="0.8" To="1.0" Duration="0:0:0.3">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                                                                                From="0.8" To="1.0" Duration="0:0:0.3">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <ColorAnimation Storyboard.TargetProperty="BorderBrush.Color"
                                                                                To="#4CAF50" Duration="0:0:0.2"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <!-- Placeholder background -->
                                        <Rectangle Fill="#2A2A2A">
                                            <Rectangle.Style>
                                                <Style TargetType="Rectangle">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Rectangle.Style>
                                        </Rectangle>
                                        
                                        <!-- Placeholder text -->
                                        <TextBlock Text="{Binding PhotoNumber}" 
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontSize="48"
                                                   FontWeight="Light"
                                                   Foreground="#666">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        
                                        <!-- Captured photo -->
                                        <Image Source="{Binding Image}" 
                                               Stretch="UniformToFill">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                        
                                        <!-- Type indicator overlay for Composed and GIF -->
                                        <Border VerticalAlignment="Bottom" 
                                                HorizontalAlignment="Center"
                                                Background="#CC000000"
                                                CornerRadius="4"
                                                Padding="8,3"
                                                Margin="0,0,0,6">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ItemType}" Value="Composed">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ItemType}" Value="GIF">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock FontSize="12" Foreground="White" FontWeight="Bold">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value=""/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding ItemType}" Value="Composed">
                                                                <Setter Property="Text" Value="LAYOUT"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding ItemType}" Value="GIF">
                                                                <Setter Property="Text" Value="GIF"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>
                                        
                                        <!-- Photo number label -->
                                        <Border HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Background="#AA000000"
                                                CornerRadius="5"
                                                Margin="4"
                                                Padding="6,3">
                                            <TextBlock Text="{Binding PhotoNumber}" 
                                                       Foreground="White"
                                                       FontSize="14"
                                                       FontWeight="Bold"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Bottom Control Bar (Collapsible) -->
        <Border x:Name="bottomControlBar" 
                Grid.Row="2" 
                Background="#333333" 
                Padding="20"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left side empty now that countdown moved to top-right -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Empty - chevron toggle is now positioned absolutely -->
                </StackPanel>

                <!-- Spacer for Center Alignment -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <!-- Empty space - buttons moved to main preview area -->
                </StackPanel>
                
                <!-- Event/Template Selection Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button x:Name="resetCameraButton" 
                            Style="{StaticResource SettingsButtonStyle}"
                            Width="70"
                            Height="70"
                            Margin="0,0,10,0"
                            Click="ResetCameraButton_Click"
                            ToolTip="Reset Camera">
                        <Viewbox Width="35" Height="35">
                            <Canvas Width="24" Height="24">
                                <Path Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" Fill="White"/>
                            </Canvas>
                        </Viewbox>
                    </Button>
                    
                    <Button x:Name="cameraSettingsButton" 
                            Style="{StaticResource SettingsButtonStyle}"
                            Width="70"
                            Height="70"
                            Margin="0,0,10,0"
                            Click="CameraSettingsButton_Click"
                            ToolTip="Camera Settings">
                        <Viewbox Width="35" Height="35">
                            <Canvas Width="24" Height="24">
                                <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" Fill="White" Opacity="0"/>
                                <Path Data="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" Fill="White"/>
                            </Canvas>
                        </Viewbox>
                    </Button>
                    
                    <Button x:Name="eventSettingsButton" 
                            Style="{StaticResource SettingsButtonStyle}"
                            Width="70"
                            Height="70"
                            Margin="0,0,10,0"
                            Click="EventSettingsButton_Click"
                            ToolTip="Event Settings">
                        <Viewbox Width="35" Height="35">
                            <Canvas Width="24" Height="24">
                                <Path Data="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" Fill="White"/>
                            </Canvas>
                        </Viewbox>
                    </Button>
                    
                    <Button x:Name="modernSettingsButton" 
                            Style="{StaticResource SettingsButtonStyle}"
                            Width="70"
                            Height="70"
                            Margin="0,0,10,0"
                            Click="ModernSettingsButton_Click"
                            ToolTip="Advanced Settings">
                        <Viewbox Width="35" Height="35">
                            <Canvas Width="24" Height="24">
                                <Path Data="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" Fill="White"/>
                            </Canvas>
                        </Viewbox>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Event/Template Selection Overlay -->
        <Grid x:Name="eventSelectionOverlay" 
              Grid.RowSpan="3" 
              Background="#E0000000" 
              Visibility="Collapsed">
            <Border Background="#FF2E2E2E" 
                    CornerRadius="20" 
                    Margin="100" 
                    Padding="40">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Title -->
                    <TextBlock Grid.Row="0" 
                               x:Name="overlayTitleText"
                               Text="Select Event" 
                               FontSize="36" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center" 
                               Margin="0,0,0,30"/>
                    
                    <!-- Event Selection -->
                    <TextBlock Grid.Row="1" 
                               Text="Choose Event:" 
                               FontSize="24" 
                               Foreground="White" 
                               Margin="0,0,0,15"/>
                    
                    <ScrollViewer Grid.Row="2" 
                                  VerticalScrollBarVisibility="Auto" 
                                  MaxHeight="200" 
                                  Margin="0,0,0,20">
                        <ItemsControl x:Name="eventsListControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#FF404040" 
                                            CornerRadius="10" 
                                            Margin="5" 
                                            Padding="15"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="OnEventSelected"
                                            Tag="{Binding}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#FF505050"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" 
                                                       FontSize="20" 
                                                       FontWeight="Bold" 
                                                       Foreground="White"/>
                                            <TextBlock Text="{Binding EventType}" 
                                                       FontSize="14" 
                                                       Foreground="#FFCCCCCC"/>
                                            <TextBlock Text="{Binding Location}" 
                                                       FontSize="14" 
                                                       Foreground="#FFCCCCCC"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Template Selection -->
                    <TextBlock Grid.Row="3" 
                               Text="Choose Template:" 
                               FontSize="24" 
                               Foreground="White" 
                               Margin="0,20,0,15"/>
                    
                    <ScrollViewer Grid.Row="4" 
                                  VerticalScrollBarVisibility="Auto" 
                                  MaxHeight="400" 
                                  Margin="0,0,0,20">
                        <ItemsControl x:Name="templatesListControl">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" 
                                               HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#FF404040" 
                                            CornerRadius="10" 
                                            Margin="10" 
                                            Padding="10"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="OnTemplateSelected"
                                            Tag="{Binding}"
                                            Width="250"
                                            Height="320">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#FF505050"/>
                                                        <Setter Property="BorderBrush" Value="#FF00B4D8"/>
                                                        <Setter Property="BorderThickness" Value="3"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="200"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Template Thumbnail -->
                                            <Border Grid.Row="0" 
                                                    Background="#FF2A2A2A" 
                                                    CornerRadius="5"
                                                    Margin="0,0,0,10">
                                                <Grid>
                                                    <!-- Thumbnail Image -->
                                                    <Image Source="{Binding ThumbnailImagePath}"
                                                           Stretch="Uniform"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center">
                                                        <Image.Effect>
                                                            <DropShadowEffect Color="Black" 
                                                                              Direction="270" 
                                                                              ShadowDepth="2" 
                                                                              Opacity="0.5"/>
                                                        </Image.Effect>
                                                    </Image>
                                                    
                                                    <!-- Fallback if no thumbnail -->
                                                    <TextBlock Text="📷"
                                                               FontSize="60"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               Foreground="#FF666666">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ThumbnailImagePath}" Value="{x:Null}">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding ThumbnailImagePath}" Value="">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                            
                                            <!-- Template Name -->
                                            <TextBlock Grid.Row="1"
                                                       Text="{Binding Name}" 
                                                       FontSize="18" 
                                                       FontWeight="Bold" 
                                                       Foreground="White"
                                                       TextAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       Margin="5,0"/>
                                            
                                            <!-- Template Description -->
                                            <TextBlock Grid.Row="2"
                                                       Text="{Binding Description}" 
                                                       FontSize="12" 
                                                       Foreground="#FFCCCCCC"
                                                       TextAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       Margin="5,5,5,0"
                                                       VerticalAlignment="Top"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="5" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                Margin="0,30,0,0">
                        <Button x:Name="cancelSelectionButton" 
                                Content="✕ Close" 
                                Style="{StaticResource StopButtonStyle}"
                                Width="150"
                                Height="80"
                                FontSize="20"
                                Click="CancelSelectionButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Fullscreen Retake Review Overlay -->
        <Grid x:Name="retakeReviewOverlay" 
              Grid.RowSpan="3"
              Grid.ColumnSpan="3"
              Background="#E6000000" 
              Visibility="Collapsed">
            <Border Background="#1E1E1E" 
                    CornerRadius="20" 
                    MaxWidth="1800"
                    MaxHeight="950"
                    Margin="30">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Background="#2D2D30" CornerRadius="20,20,0,0" Padding="25">
                        <Grid>
                            <TextBlock Text="Review Your Photos" 
                                       FontSize="36" 
                                       FontWeight="Bold" 
                                       Foreground="White"
                                       HorizontalAlignment="Center"/>
                            <Button Content="✕" 
                                    FontSize="28"
                                    Width="50" 
                                    Height="50"
                                    HorizontalAlignment="Right"
                                    Background="Transparent"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Click="CloseRetakeOverlay_Click"/>
                        </Grid>
                    </Border>
                    
                    <!-- Instructions -->
                    <Border Grid.Row="1" Background="#252525" Padding="20">
                        <TextBlock Text="Click on any photo you want to retake. Photos will be marked with a red border." 
                                   FontSize="20" 
                                   Foreground="#E0E0E0"
                                   HorizontalAlignment="Center"
                                   FontWeight="SemiBold"/>
                    </Border>
                    
                    <!-- Large Photo Grid -->
                    <ScrollViewer Grid.Row="2" 
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="30">
                        <ItemsControl x:Name="retakePhotoGrid">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="400" 
                                            Height="300" 
                                            Margin="20"
                                            CornerRadius="15"
                                            BorderThickness="5"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="RetakePhoto_Click"
                                            Tag="{Binding PhotoIndex}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderBrush" Value="#444"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="5" Opacity="0.3"/>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding MarkedForRetake}" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FF5722"/>
                                                        <Setter Property="BorderThickness" Value="6"/>
                                                    </DataTrigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FFA726"/>
                                                        <Setter Property="RenderTransform">
                                                            <Setter.Value>
                                                                <ScaleTransform ScaleX="1.03" ScaleY="1.03" CenterX="200" CenterY="150"/>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Setter Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect Color="#FFA726" BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <!-- Large Photo Preview -->
                                            <Image Source="{Binding Image}" 
                                                   Stretch="UniformToFill"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            
                                            <!-- Photo Label with Number -->
                                            <Border Background="#CC000000" 
                                                    VerticalAlignment="Bottom" 
                                                    CornerRadius="0,0,15,15">
                                                <Grid>
                                                    <TextBlock Text="{Binding Label}" 
                                                               Foreground="White" 
                                                               FontSize="18"
                                                               FontWeight="SemiBold"
                                                               HorizontalAlignment="Center"
                                                               Padding="10"/>
                                                    
                                                    <!-- Retake Indicator -->
                                                    <TextBlock Text="RETAKE" 
                                                               Foreground="#FF5722"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               HorizontalAlignment="Right"
                                                               Margin="0,0,15,0"
                                                               VerticalAlignment="Center"
                                                               Visibility="{Binding MarkedForRetake, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                </Grid>
                                            </Border>
                                            
                                            <!-- Retake Icon Overlay -->
                                            <Border HorizontalAlignment="Right" 
                                                    VerticalAlignment="Top"
                                                    Margin="15"
                                                    Visibility="{Binding MarkedForRetake, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Grid Width="60" Height="60">
                                                    <Ellipse Fill="#FF5722" Opacity="0.95"/>
                                                    <TextBlock Text="↻" 
                                                               Foreground="White" 
                                                               FontSize="32"
                                                               FontWeight="Bold"
                                                               HorizontalAlignment="Center" 
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                            <!-- Retake icon overlay on hover -->
                                            <Border Background="#CC000000" 
                                                    CornerRadius="50"
                                                    Width="60"
                                                    Height="60"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=IsMouseOver}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="🔄" 
                                                           FontSize="30" 
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Footer with Timer and Action Buttons -->
                    <Border Grid.Row="3" Background="#2D2D30" CornerRadius="0,0,20,20" Padding="25">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Timer Display -->
                            <StackPanel Grid.Column="0" 
                                        Orientation="Horizontal" 
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center">
                                <TextBlock Text="Time remaining: " 
                                           FontSize="20" 
                                           Foreground="#E0E0E0"/>
                                <TextBlock x:Name="retakeTimerText" 
                                           Text="15" 
                                           FontSize="24" 
                                           FontWeight="Bold" 
                                           Foreground="#4CAF50"/>
                                <TextBlock Text=" seconds" 
                                           FontSize="20" 
                                           Foreground="#E0E0E0"/>
                            </StackPanel>
                            
                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="1" 
                                        Orientation="Horizontal" 
                                        HorizontalAlignment="Right">
                                <Button Content="Retake Selected" 
                                        Width="200"
                                        Height="60"
                                        Margin="10"
                                        FontSize="20"
                                        FontWeight="SemiBold"
                                        Background="#FF5722"
                                        Foreground="White"
                                        Cursor="Hand"
                                        Click="RetakeSelected_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="30">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                
                                <Button Content="Skip Review" 
                                        Width="180"
                                        Height="60"
                                        Margin="10"
                                        FontSize="20"
                                        Background="#757575"
                                        Foreground="White"
                                        Cursor="Hand"
                                        Click="SkipRetakeReview_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="30">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                
                                <Button Content="✓ Continue" 
                                        Width="220"
                                        Height="60"
                                        Margin="10"
                                        FontSize="22"
                                        FontWeight="Bold"
                                        Background="#4CAF50"
                                        Foreground="White"
                                        Cursor="Hand"
                                        Click="ContinueFromRetake_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="30">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Filter Selection Section (now removed from retake overlay) -->
        <Grid x:Name="filterSectionContainer" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="150"/>
            </Grid.RowDefinitions>
            
            <!-- Filter Section Header -->
            <StackPanel Grid.Row="0" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Center"
                        Margin="0,0,0,5"
                        Visibility="{Binding ElementName=filterSelectionControl, Path=Visibility}">
                <TextBlock Text="Apply Filters: " 
                           FontSize="16" 
                           Foreground="White"
                           VerticalAlignment="Center"/>
                <CheckBox x:Name="enableFiltersCheckBox" 
                          Content="Enable Filters" 
                          Foreground="White"
                          FontSize="14"
                          Margin="10,0,0,0"
                          IsChecked="True"
                          VerticalAlignment="Center"
                          Checked="EnableFilters_Checked"
                          Unchecked="EnableFilters_Unchecked"/>
            </StackPanel>
            
            <!-- Filter Selection Control -->
            <controls:FilterSelectionControl x:Name="filterSelectionControl" 
                                             Grid.Row="1"
                                             Visibility="Visible"/>
        </Grid>
        
        <!-- Fullscreen Filter Selection Overlay -->
        <Grid x:Name="filterSelectionOverlay" 
              Grid.RowSpan="3"
              Grid.ColumnSpan="3"
              Background="#E6000000"
              Visibility="Collapsed"
              MouseLeftButtonDown="FilterOverlay_MouseDown">
            
            <Border MaxWidth="1600" MaxHeight="900" Margin="40"
                    Background="#1E1E1E"
                    CornerRadius="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Background="#2D2D30" CornerRadius="15,15,0,0" Padding="20">
                        <Grid>
                            <TextBlock Text="Select Photo Filter" 
                                       FontSize="32" 
                                       FontWeight="Bold" 
                                       Foreground="White"
                                       HorizontalAlignment="Center"/>
                            <Button Content="✕" 
                                    FontSize="28"
                                    Width="50" 
                                    Height="50"
                                    HorizontalAlignment="Right"
                                    Background="Transparent"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Click="CloseFilterOverlay_Click"/>
                        </Grid>
                    </Border>
                    
                    <!-- Filter Grid -->
                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto" 
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="20">
                        <ItemsControl x:Name="fullscreenFilterControl">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="320" 
                                            Height="380" 
                                            Margin="20"
                                            Background="#2A2A2A"
                                            CornerRadius="12"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="FullscreenFilterItem_Click"
                                            Tag="{Binding}">
                                        <Border.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="8" Opacity="0.4"/>
                                        </Border.Effect>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="60"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Large Filter Preview -->
                                            <Border Grid.Row="0" 
                                                    Margin="12"
                                                    CornerRadius="10"
                                                    ClipToBounds="True"
                                                    BorderThickness="3"
                                                    BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}">
                                                <Image Source="{Binding PreviewImage}" 
                                                       Stretch="UniformToFill"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Border>
                                            
                                            <!-- Filter Name -->
                                            <Border Grid.Row="1" 
                                                    Background="#1A1A1A" 
                                                    CornerRadius="0,0,12,12">
                                                <TextBlock Text="{Binding Name}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Foreground="White"
                                                           FontSize="20"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                            
                                            <!-- Selected Indicator -->
                                            <Border Grid.Row="0" 
                                                    HorizontalAlignment="Right" 
                                                    VerticalAlignment="Top"
                                                    Margin="20"
                                                    Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Grid Width="50" Height="50">
                                                    <Ellipse Fill="#4CAF50" Opacity="0.95"/>
                                                    <TextBlock Text="✓" 
                                                               Foreground="White" 
                                                               FontSize="30"
                                                               FontWeight="Bold"
                                                               HorizontalAlignment="Center" 
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Footer with Apply Button -->
                    <Border Grid.Row="2" Background="#2D2D30" CornerRadius="0,0,15,15" Padding="25">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button x:Name="applyFilterButton"
                                    Content="Apply Filter" 
                                    Width="250" 
                                    Height="60"
                                    FontSize="22"
                                    FontWeight="Bold"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    Cursor="Hand"
                                    Click="ApplyFilter_Click"
                                    Margin="15,0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="30">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button Content="Cancel" 
                                    Width="250" 
                                    Height="60"
                                    FontSize="22"
                                    FontWeight="Bold"
                                    Background="#E53E3E"
                                    Foreground="White"
                                    Cursor="Hand"
                                    Click="CloseFilterOverlay_Click"
                                    Margin="15,0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="30">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Camera Settings Overlay -->
        <Grid x:Name="cameraSettingsOverlay" 
              Grid.RowSpan="3" 
              Background="#E0000000" 
              Visibility="Collapsed">
            <Border Background="#FF2E2E2E" 
                    CornerRadius="20" 
                    MaxWidth="900"
                    MaxHeight="600"
                    Margin="50" 
                    Padding="30">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" MinWidth="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Header -->
                    <Grid Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,20">
                        <TextBlock Text="Camera Settings" 
                                   FontSize="28" 
                                   FontWeight="Bold" 
                                   Foreground="White"/>
                        <Button Content="✕" 
                                FontSize="24"
                                HorizontalAlignment="Right"
                                Background="Transparent"
                                Foreground="White"
                                BorderThickness="0"
                                Width="40"
                                Height="40"
                                Click="CloseCameraSettings_Click"/>
                    </Grid>
                    
                    <!-- Settings Content -->
                    <ScrollViewer Grid.Row="1" Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0,0,20,0">
                        <StackPanel>
                            <!-- Camera Selection -->
                            <TextBlock Text="Camera:" 
                                       FontSize="16" 
                                       Foreground="White" 
                                       Margin="0,0,0,10"/>
                            <ComboBox x:Name="cameraComboBox" 
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,0,20"
                                      SelectionChanged="CameraComboBox_SelectionChanged"/>
                            
                            <!-- ISO Setting -->
                            <TextBlock Text="ISO:" 
                                       FontSize="16" 
                                       Foreground="White" 
                                       Margin="0,0,0,10"/>
                            <ComboBox x:Name="isoComboBox" 
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,0,20"
                                      SelectionChanged="IsoComboBox_SelectionChanged"/>
                            
                            <!-- Aperture Setting -->
                            <TextBlock Text="Aperture:" 
                                       FontSize="16" 
                                       Foreground="White" 
                                       Margin="0,0,0,10"/>
                            <ComboBox x:Name="apertureComboBox" 
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,0,20"
                                      SelectionChanged="ApertureComboBox_SelectionChanged"/>
                            
                            <!-- Shutter Speed Setting -->
                            <TextBlock Text="Shutter Speed:" 
                                       FontSize="16" 
                                       Foreground="White" 
                                       Margin="0,0,0,10"/>
                            <ComboBox x:Name="shutterSpeedComboBox" 
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,0,20"
                                      SelectionChanged="ShutterSpeedComboBox_SelectionChanged"/>
                            
                            <!-- White Balance Setting -->
                            <TextBlock Text="White Balance:" 
                                       FontSize="16" 
                                       Foreground="White" 
                                       Margin="0,0,0,10"/>
                            <ComboBox x:Name="whiteBalanceComboBox" 
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,0,20"
                                      SelectionChanged="WhiteBalanceComboBox_SelectionChanged"/>
                            
                            <!-- Capture Mode -->
                            <CheckBox x:Name="captureInSdRamCheckBox" 
                                      Content="Capture in SD RAM (Faster)" 
                                      FontSize="14"
                                      Foreground="White"
                                      Margin="0,10,0,20"
                                      Checked="CaptureInSdRamCheckBox_Changed"
                                      Unchecked="CaptureInSdRamCheckBox_Changed"/>
                        </StackPanel>
                    </ScrollViewer>
                    
                    <!-- Test Photo Preview Area -->
                    <Grid Grid.Row="1" Grid.Column="1">
                        <Border Background="#1E1E1E" 
                                CornerRadius="10" 
                                BorderBrush="#444"
                                BorderThickness="1">
                            <Grid>
                                <TextBlock Text="Test Photo Preview" 
                                           FontSize="14" 
                                           Foreground="#666"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           x:Name="testPhotoPlaceholderText"/>
                                <Image x:Name="testPhotoImage" 
                                       Stretch="Uniform"
                                       Margin="10"
                                       Visibility="Collapsed"/>
                                <ProgressBar x:Name="testPhotoProgressBar"
                                            IsIndeterminate="True"
                                            Height="4"
                                            VerticalAlignment="Bottom"
                                            Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                    </Grid>
                    
                    <!-- Footer Buttons -->
                    <StackPanel Grid.Row="2" Grid.ColumnSpan="2"
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,20,0,0">
                        <Button Content="Test Capture" 
                                Width="150"
                                Height="45"
                                FontSize="16"
                                Margin="0,0,20,0"
                                Style="{StaticResource SettingsButtonStyle}"
                                Click="TestCaptureButton_Click"/>
                        <Button Content="Close" 
                                Width="150"
                                Height="45"
                                FontSize="16"
                                Style="{StaticResource TouchButtonStyle}"
                                Click="CloseCameraSettings_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Gallery Overlay Control -->
        <controls:GalleryOverlayControl x:Name="galleryOverlay" 
                                         Visibility="Collapsed"
                                         Grid.RowSpan="3"/>
        
        <!-- Post-Session Filter Selection Overlay -->
        <Grid x:Name="postSessionFilterOverlay" 
              Grid.RowSpan="3"
              Grid.ColumnSpan="3"
              Background="#E6000000"
              Visibility="Collapsed"
              Panel.ZIndex="1000"
              MouseLeftButtonDown="PostSessionFilterOverlay_MouseDown">
            
            <Border MaxWidth="1400" MaxHeight="850" Margin="50"
                    Background="#1E1E1E"
                    CornerRadius="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Background="#2D2D30" CornerRadius="15,15,0,0" Padding="25">
                        <Grid>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="Apply Filters to Your Photos" 
                                           FontSize="36" 
                                           FontWeight="Bold" 
                                           Foreground="White"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Select a filter to apply to all photos from this session" 
                                           FontSize="18" 
                                           Foreground="#B0B0B0"
                                           HorizontalAlignment="Center"
                                           Margin="0,10,0,0"/>
                            </StackPanel>
                            <Button Content="✕" 
                                    FontSize="32"
                                    Width="60" 
                                    Height="60"
                                    HorizontalAlignment="Right"
                                    Background="Transparent"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Click="ClosePostSessionFilterOverlay_Click"/>
                        </Grid>
                    </Border>
                    
                    <!-- Filter Grid with Preview -->
                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto" 
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="30">
                        <ItemsControl x:Name="postSessionFilterControl">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="280" 
                                            Height="340" 
                                            Margin="15"
                                            Background="#2A2A2A"
                                            CornerRadius="12"
                                            Cursor="Hand"
                                            MouseLeftButtonUp="PostSessionFilterItem_Click"
                                            Tag="{Binding}">
                                        <Border.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="5" Opacity="0.3"/>
                                        </Border.Effect>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="60"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Filter Preview -->
                                            <Border Grid.Row="0" 
                                                    Margin="10"
                                                    CornerRadius="8"
                                                    ClipToBounds="True"
                                                    BorderThickness="3"
                                                    BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}">
                                                <Image Source="{Binding PreviewImage}" 
                                                       Stretch="UniformToFill"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Border>
                                            
                                            <!-- Filter Name -->
                                            <Border Grid.Row="1" 
                                                    Background="#1A1A1A" 
                                                    CornerRadius="0,0,12,12">
                                                <TextBlock Text="{Binding Name}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Foreground="White"
                                                           FontSize="18"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                            
                                            <!-- Selected Indicator -->
                                            <Border Grid.Row="0" 
                                                    HorizontalAlignment="Right" 
                                                    VerticalAlignment="Top"
                                                    Margin="18"
                                                    Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Grid Width="45" Height="45">
                                                    <Ellipse Fill="#4CAF50" Opacity="0.95"/>
                                                    <TextBlock Text="✓" 
                                                               Foreground="White" 
                                                               FontSize="26"
                                                               FontWeight="Bold"
                                                               HorizontalAlignment="Center" 
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Footer with Action Buttons -->
                    <Border Grid.Row="2" Background="#2D2D30" CornerRadius="0,0,15,15" Padding="30">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Skip Filter Option -->
                            <CheckBox Grid.Column="0"
                                      x:Name="skipFiltersCheckBox"
                                      Content="Don't apply any filters" 
                                      Foreground="White"
                                      FontSize="16"
                                      VerticalAlignment="Center"
                                      Margin="0,0,20,0"/>
                            
                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="2" 
                                        Orientation="Horizontal" 
                                        HorizontalAlignment="Right">
                                <Button x:Name="applyPostSessionFilterButton"
                                        Content="Apply Filter &amp; Continue" 
                                        Width="280" 
                                        Height="65"
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Background="#4CAF50"
                                        Foreground="White"
                                        Cursor="Hand"
                                        Click="ApplyPostSessionFilter_Click"
                                        Margin="10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="32">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                
                                <Button Content="Skip Filters" 
                                        Width="200" 
                                        Height="65"
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Background="#666666"
                                        Foreground="White"
                                        Cursor="Hand"
                                        Click="SkipPostSessionFilter_Click"
                                        Margin="10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="32">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Bottom Bar Toggle Button (Chevron) - Left side -->
        <Border Grid.RowSpan="3"
                VerticalAlignment="Bottom" 
                HorizontalAlignment="Left" 
                Background="#FF444444" 
                CornerRadius="0,20,0,0" 
                Padding="20,15" 
                Margin="20,0,0,0"
                Cursor="Hand"
                Panel.ZIndex="500"
                MouseLeftButtonDown="ToggleBottomBar_Click">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="5" Opacity="0.7"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="bottomBarToggleChevron" 
                           Text="⌃" 
                           FontSize="24" 
                           Foreground="White" 
                           FontWeight="Bold"
                           Margin="0,0,10,0"/>
                <TextBlock Text="Settings" 
                           FontSize="14" 
                           Foreground="White" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- PIN Entry Overlay -->
        <Grid x:Name="pinEntryOverlay" 
              Grid.RowSpan="3" 
              Background="#40000000" 
              Visibility="Collapsed">
            <Grid.Resources>
                <!-- Glass Style Round PIN Button -->
                <Style x:Key="ModernPinButtonStyle" TargetType="Button">
                    <Setter Property="Background" Value="#10FFFFFF"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="#30FFFFFF"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="FontWeight" Value="Light"/>
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <Ellipse x:Name="border" 
                                            Stroke="{TemplateBinding BorderBrush}"
                                            StrokeThickness="1"
                                            Fill="{TemplateBinding Background}"/>
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                      VerticalAlignment="Center"/>
                                </Grid>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Fill" Value="#20FFFFFF"/>
                                        <Setter TargetName="border" Property="Stroke" Value="#50FFFFFF"/>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter TargetName="border" Property="Fill" Value="#30FFFFFF"/>
                                        <Setter TargetName="border" Property="Stroke" Value="#80FFFFFF"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Grid.Resources>
            
            <Border Background="#15FFFFFF" 
                    CornerRadius="25" 
                    Width="400"
                    Height="580"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BorderBrush="#20FFFFFF"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="#80000000" BlurRadius="30" ShadowDepth="0" Opacity="0.3"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Lock Icon and Title -->
                    <StackPanel Grid.Row="0" Margin="0,25,0,10">
                        <Border Width="60" Height="60" 
                                Background="#10FFFFFF"
                                CornerRadius="30"
                                BorderBrush="#20FFFFFF"
                                BorderThickness="1"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,12">
                            <TextBlock Text="🔒" 
                                       FontSize="28"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="Enter Security PIN" 
                                   FontSize="20" 
                                   FontWeight="Light"
                                   Foreground="#E0FFFFFF"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- PIN Display Dots -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                Margin="0,8,0,20">
                        <Border x:Name="pinDot1" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                        <Border x:Name="pinDot2" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                        <Border x:Name="pinDot3" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                        <Border x:Name="pinDot4" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                        <Border x:Name="pinDot5" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                        <Border x:Name="pinDot6" Width="12" Height="12" 
                                Background="#20FFFFFF" CornerRadius="6" Margin="6"
                                BorderBrush="#30FFFFFF" BorderThickness="1"/>
                    </StackPanel>
                    
                    <!-- Hidden TextBox for PIN storage -->
                    <TextBox x:Name="pinDisplayBox" 
                             Grid.Row="1"
                             Visibility="Collapsed"
                             MaxLength="6"/>
                    
                    <!-- Glass Style Number Pad -->
                    <Grid Grid.Row="2" Width="300" HorizontalAlignment="Center">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="75"/>
                            <RowDefinition Height="75"/>
                            <RowDefinition Height="75"/>
                            <RowDefinition Height="75"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Number buttons with phone labels -->
                        <Button Grid.Row="0" Grid.Column="0" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="1" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="1" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="2" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="ABC" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="2" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="3" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="DEF" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Grid.Row="1" Grid.Column="0" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="4" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="GHI" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="1" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="5" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="JKL" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="2" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="6" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="MNO" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Grid.Row="2" Grid.Column="0" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="7" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="PQRS" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="1" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="8" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="TUV" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="2" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="9" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="WXYZ" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Bottom row with special buttons -->
                        <Button Grid.Row="3" Grid.Column="0" Content="←" 
                                Width="60" Height="45" Margin="8"
                                FontSize="18" FontWeight="Light"
                                Background="#15FFFFFF"
                                Foreground="#E0FFFFFF"
                                BorderBrush="#30FFFFFF"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="PinClearButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" 
                                            CornerRadius="22"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#25FFFFFF"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#50FFFFFF"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#35FFFFFF"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <Button Grid.Row="3" Grid.Column="1" 
                                Style="{StaticResource ModernPinButtonStyle}" 
                                Width="60" Height="60" Margin="8" 
                                Click="PinPadButton_Click">
                            <StackPanel>
                                <TextBlock Text="0" FontSize="22" HorizontalAlignment="Center" FontWeight="Light"/>
                                <TextBlock Text="+" FontSize="7" HorizontalAlignment="Center" Opacity="0.6"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Grid.Row="3" Grid.Column="2" Content="✓" 
                                Width="60" Height="45" Margin="8"
                                FontSize="20" FontWeight="Light"
                                Background="#15FFFFFF"
                                Foreground="#E0FFFFFF"
                                BorderBrush="#30FFFFFF"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="PinSubmitButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" 
                                            CornerRadius="22"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#25FFFFFF"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#50FFFFFF"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#35FFFFFF"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                    
                    <!-- Bottom Glass Buttons -->
                    <Grid Grid.Row="3" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Back button (Clear) -->
                        <Button Grid.Column="0" 
                                Content="Cancel" 
                                Width="80"
                                Height="32"
                                FontSize="12"
                                FontWeight="Light"
                                Foreground="#D0FFFFFF"
                                Background="#10FFFFFF"
                                BorderBrush="#20FFFFFF"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="PinClearButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="16">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#20FFFFFF"/>
                                            <Setter Property="BorderBrush" Value="#40FFFFFF"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="#30FFFFFF"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <!-- End button (Submit) -->
                        <Button Grid.Column="2" 
                                Content="Clear" 
                                Width="80"
                                Height="32"
                                FontSize="12"
                                FontWeight="Light"
                                Foreground="#D0FFFFFF"
                                Background="#10FFFFFF"
                                BorderBrush="#20FFFFFF"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="PinClearButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="16">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#20FFFFFF"/>
                                            <Setter Property="BorderBrush" Value="#40FFFFFF"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="#30FFFFFF"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                    
                    <!-- Error/Status Message -->
                    <Border Grid.Row="4" Margin="20,10">
                        <StackPanel>
                            <TextBlock x:Name="pinErrorText" 
                                       Text=""
                                       FontSize="14"
                                       FontWeight="Normal"
                                       Foreground="#FFFF6B6B"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="Collapsed"/>
                            
                            <!-- Cancel link -->
                            <TextBlock HorizontalAlignment="Center" 
                                       Margin="0,8,0,16"
                                       Cursor="Hand"
                                       MouseLeftButtonUp="PinCancelButton_Click">
                                <Run Text="Cancel" Foreground="#80FFFFFF" FontSize="11"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Video Player Overlay -->
        <Grid x:Name="videoPlayerOverlay" 
              Grid.RowSpan="3" 
              Background="#E0000000" 
              Visibility="Collapsed"
              MouseLeftButtonDown="VideoPlayerOverlay_MouseLeftButtonDown">
            <Border Background="#FF1E1E1E" 
                    CornerRadius="20" 
                    Width="800"
                    Height="600"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Title Bar -->
                    <Border Grid.Row="0" Background="#FF2E2E2E" CornerRadius="20,20,0,0" Padding="20,15">
                        <Grid>
                            <TextBlock Text="Animation Preview" 
                                       FontSize="18" 
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"/>
                            <Button Content="✕" 
                                    FontSize="20"
                                    Foreground="White"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Right"
                                    Width="30"
                                    Height="30"
                                    Click="CloseVideoPlayer_Click"/>
                        </Grid>
                    </Border>
                    
                    <!-- Video Player -->
                    <MediaElement Grid.Row="1" 
                                  x:Name="videoPlayer"
                                  LoadedBehavior="Manual"
                                  UnloadedBehavior="Stop"
                                  Stretch="Uniform"
                                  MediaEnded="VideoPlayer_MediaEnded"/>
                    
                    <!-- Controls -->
                    <StackPanel Grid.Row="2" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,10,0,20">
                        <Button x:Name="playPauseButton"
                                Content="▶️" 
                                FontSize="24"
                                Width="60"
                                Height="40"
                                Margin="5"
                                Background="#FF2196F3"
                                Foreground="White"
                                BorderThickness="0"
                                Click="PlayPauseButton_Click"/>
                        <Button Content="🔄" 
                                FontSize="24"
                                Width="60"
                                Height="40"
                                Margin="5"
                                Background="#FF4CAF50"
                                Foreground="White"
                                BorderThickness="0"
                                Click="RestartButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Modern Settings Overlay (Fullscreen) -->
        <Grid x:Name="modernSettingsOverlay" 
              Grid.RowSpan="3" 
              Background="#FF1E1E1E" 
              Visibility="Collapsed"
              Panel.ZIndex="1000">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="80"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Title Bar -->
                <Border Grid.Row="0" Background="#FF2E2E2E">
                    <Grid>
                        <TextBlock Text="🔧 Advanced Photobooth Settings" 
                                   FontSize="28" 
                                   FontWeight="Bold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                        <Button Content="✕ Close" 
                                FontSize="20"
                                FontWeight="Bold"
                                Foreground="White"
                                Background="#FFDC2626"
                                BorderThickness="0"
                                HorizontalAlignment="Right"
                                Width="150"
                                Height="50"
                                Margin="20"
                                Click="CloseModernSettings_Click"
                                Style="{StaticResource TouchButtonStyle}"/>
                    </Grid>
                </Border>
                
                <!-- Settings Content -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Background="#FF1E1E1E">
                    <local:PhotoboothSettingsControl x:Name="modernSettingsControl" 
                                                      Margin="40,20,40,20"/>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Page>