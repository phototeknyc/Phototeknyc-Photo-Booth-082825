<UserControl x:Class="Photobooth.MVVM.Views.UserControls.Camera.CameraMain"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"              
             xmlns:T="clr-namespace:CameraControl.Core.Translation;assembly=CameraControl.Core"
             xmlns:utils="clr-namespace:Photobooth.MVVM.Utils"
             mc:Ignorable="d" d:DesignWidth="800" d:Height="500">
    <UserControl.Resources>
        <ResourceDictionary>
            <T:TranslateConverter x:Key="converter" />
            <utils:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="0"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Sidebar with camera controls -->
        <ScrollViewer Grid.Column="0" Grid.RowSpan="2" VerticalScrollBarVisibility="Auto" Margin="5,0,5,0">
            <Border BorderBrush="#ccc" BorderThickness="0,0,1,0" Margin="0,0,0,5">
                <ContentControl Content="{Binding}">
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsLoadingDeviceManager}" Value="True">
                                    <Setter Property="ContentTemplate">
                                        <Setter.Value>
                                            <DataTemplate>
                                                <TextBlock Text="Connecting Devices..." FontSize="16" Foreground="#FFEDEDED" TextAlignment="Center" Background="Transparent"/>
                                            </DataTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsLoadingDeviceManager}" Value="False">
                                    <Setter Property="ContentTemplate">
                                        <Setter.Value>
                                            <DataTemplate>
                                                <StackPanel Orientation="Vertical">
                                                    <ComboBox x:Name="cmb_cameras" DisplayMemberPath="DeviceName" VerticalAlignment="Center" Width="150" Height="30"
                                                  ItemsSource="{Binding DeviceManager.ConnectedDevices}" SelectedItem="{Binding DeviceManager.SelectedCameraDevice}" Margin="10" />
                                                    <ComboBox x:Name="cmb_templates" DisplayMemberPath="Name" VerticalAlignment="Center" Width="150" Height="30"
                                                  ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate}" Margin="10" />

                                                    <Border BorderThickness="0,1,0,1" BorderBrush="#FFEDEDED" Margin="0,10,0,0">
                                                        <StackPanel Orientation="Vertical" Height="Auto" HorizontalAlignment="Center" Width="170">
                                                            <TextBlock Text="Control" FontSize="20" Foreground="#FFEDEDED" TextAlignment="Center" Background="Transparent" />
                                                            <Button Content="Capture" IsEnabled="{Binding IsLiveViewSupported}" Height="30" Margin="5,5,10,5" Command="{Binding CaptureCommand}"/>
                                                            <Button Content="Live View" Height="30" Margin="5" Command="{Binding LiveViewCommand}"/>
                                                            <Button Content="Stop" IsEnabled="{Binding IsRunning}" Height="30" Margin="5" Command="{Binding StopCommand}"/>
                                                            <Button Content="Template" Height="30" Margin="5" Command="{Binding StartCaptureWithTemplate}"/>
                                                        </StackPanel>
                                                    </Border>
                                                    
                                                    <StackPanel  HorizontalAlignment="Stretch" VerticalAlignment="Top" Margin="4" >
                                                        <StackPanel Visibility="{Binding DeviceManager.SelectedCameraDevice.Mode.Available, Converter={StaticResource BooleanToVisibilityConverter}}" >
                                                            <Label Content="Mode" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.Mode.ErrorColor}" >
                                                                <ComboBox Name="cmb_mode" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.Mode.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.Mode.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.Mode.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel  Visibility="{Binding SelectedCameraDevice.IsoNumber.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="ISO" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.IsoNumber.ErrorColor}" >
                                                                <ComboBox Name="cmb_iso" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.IsoNumber.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.IsoNumber.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.IsoNumber.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.ShutterSpeed.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Shutter Speed" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.ShutterSpeed.ErrorColor}" >
                                                                <ComboBox Name="cmb_shutter" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.ShutterSpeed.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.ShutterSpeed.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.ShutterSpeed.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.FNumber.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Aperture" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.FNumber.ErrorColor}" >
                                                                <ComboBox Name="cmb_aperture" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.FNumber.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.FNumber.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.FNumber.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.WhiteBalance.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="White Balance" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.WhiteBalance.ErrorColor}" >
                                                                <ComboBox Name="cmb_WB" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.WhiteBalance.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.WhiteBalance.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.WhiteBalance.Value}" ToolTip="{Binding DeviceManager.SelectedCameraDevice.WhiteBalance.Value}">
                                                                    <ComboBox.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <Label Content="{Binding Converter={StaticResource converter}}"/>
                                                                        </DataTemplate>
                                                                    </ComboBox.ItemTemplate>
                                                                </ComboBox>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.ExposureCompensation.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Exposure Comp." Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.ExposureCompensation.ErrorColor}" >
                                                                <ComboBox Name="cmb_EComp" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.ExposureCompensation.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.ExposureCompensation.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.ExposureCompensation.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.CompressionSetting.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Compression" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.CompressionSetting.ErrorColor}" >
                                                                <ComboBox Name="cmb_com" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.CompressionSetting.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.CompressionSetting.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.CompressionSetting.Value}" ToolTip="{Binding DeviceManager.SelectedCameraDevice.CompressionSetting.Value}"/>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.ExposureMeteringMode.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Metering Mode" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.ExposureMeteringMode.ErrorColor}" >
                                                                <ComboBox Name="cmb_meter"  IsEnabled="{Binding DeviceManager.SelectedCameraDevice.ExposureMeteringMode.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.ExposureMeteringMode.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.ExposureMeteringMode.Value}" ToolTip="{Binding DeviceManager.SelectedCameraDevice.ExposureMeteringMode.Value}">
                                                                    <ComboBox.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <Label Content="{Binding Converter={StaticResource converter}}"/>
                                                                        </DataTemplate>
                                                                    </ComboBox.ItemTemplate>
                                                                </ComboBox>
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Visibility="{Binding SelectedCameraDevice.FocusMode.Available, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <Label Content="Focus Mode" Foreground="#FFEDEDED" />
                                                            <Border BorderThickness="1" BorderBrush="{Binding DeviceManager.SelectedCameraDevice.FocusMode.ErrorColor}" >
                                                                <ComboBox Name="cmb_focus" IsEnabled="{Binding DeviceManager.SelectedCameraDevice.FocusMode.IsEnabled}" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.FocusMode.Values}" SelectedValue="{Binding DeviceManager.SelectedCameraDevice.FocusMode.Value}" ToolTip="{Binding DeviceManager.SelectedCameraDevice.FocusMode.Value}">
                                                                    <ComboBox.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <Label Content="{Binding Converter={StaticResource converter}}"/>
                                                                        </DataTemplate>
                                                                    </ComboBox.ItemTemplate>
                                                                </ComboBox>
                                                            </Border>
                                                        </StackPanel>
                                                        <ListBox ItemsSource="{Binding DeviceManager.SelectedCameraDevice.Properties}" HorizontalAlignment="Left">
                                                            <ListBox.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border Margin="4" BorderThickness="1" BorderBrush="Gray">
                                                                        <StackPanel Margin="4">
                                                                            <Border BorderThickness="1" BorderBrush="{Binding Path=ErrorColor}">
                                                                                <ComboBox IsEnabled="{Binding Path=IsEnabled}" ItemsSource="{Binding Path=Values}" SelectedValue="{Binding Path=Value}" ToolTip="{Binding Value}" >
                                                                                    <ComboBox.ItemTemplate>
                                                                                        <DataTemplate>
                                                                                            <Label Content="{Binding Converter={StaticResource converter}}"/>
                                                                                        </DataTemplate>
                                                                                    </ComboBox.ItemTemplate>
                                                                                </ComboBox>
                                                                            </Border>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ListBox.ItemTemplate>
                                                        </ListBox>
                                                        <ItemsControl Name="listBox1" ItemsSource="{Binding DeviceManager.SelectedCameraDevice.AdvancedProperties}" HorizontalAlignment="Stretch"  Margin="0">
                                                            <ItemsControl.ItemContainerStyle>
                                                                <Style TargetType="{x:Type FrameworkElement}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Available}" Value="False">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ItemsControl.ItemContainerStyle>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Margin="0" >
                                                                        <Border BorderThickness="1" BorderBrush="{Binding Path=ErrorColor}">
                                                                            <ComboBox IsEnabled="{Binding Path=IsEnabled}" ItemsSource="{Binding Path=Values}" SelectedValue="{Binding Path=Value}" ToolTip="{Binding Value}">
                                                                                <ComboBox.ItemTemplate>
                                                                                    <DataTemplate>
                                                                                        <TextBlock Text="{Binding Converter={StaticResource converter}}"/>
                                                                                    </DataTemplate>
                                                                                </ComboBox.ItemTemplate>
                                                                            </ComboBox>
                                                                        </Border>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                    
                                                </StackPanel>
                                            </DataTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </Border>

        </ScrollViewer>

        <Grid Grid.Column="1" Grid.Row="0" HorizontalAlignment="Center" VerticalAlignment="Center">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <ContentControl Content="{Binding CameraDesignerVM.CustomDesignerCanvas}" VerticalAlignment="Top" HorizontalAlignment="Left" Background="{DynamicResource ForegroundBrush}" Margin="10"/>
            </ScrollViewer>
        </Grid>

        <!-- Main content area with camera image -->
        <Grid Grid.Column="1" Grid.Row="1">
            <Viewbox Stretch="Uniform">
                <Image x:Name="imgCamera" 
               HorizontalAlignment="Center" 
               VerticalAlignment="Center" 
               Stretch="Uniform"
               Source="{Binding LiveImage}"/>
            </Viewbox>
        </Grid>

    </Grid>
</UserControl>
